<!DOCTYPE html>
<html>
<head>
    <title>Tab Cloaking Demo</title>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function inIframe() {
            try {
                return window.self !== window.top;
            } catch (e) {
                return true;
            }
        }

        if ((!inIframe()) && getCookie("cloak") && (!urlParams.get("disable"))) {
            console.log(window.location.href);
            window.doCloak = true;
            if (cloak(window.location.href, true)) {
                window.location.replace("https://google.com");
            }
        } else {
            if (!inIframe()) {
                document.cookie = "cloak=";
                window.doCloak = false;
            } else {
                window.doCloak = true;
            }
        }

        function cloak(url, absolute) {
            absolute = absolute || false;
            url = absolute ? url : window.location.href.replace(/\/$/, "") + url;
            if (window.doCloak) {
                var page = window.open('about:blank', '_blank');
                page.location.href = url;
                return true;
            } else {
                window.open(url);
            }
        }
    </script>
</head>
<body>
    <!-- Your website content goes here -->
</body>
</html>
